'use strict';angular.module('console.resource_management', [    {        files: [            'components/searchbar/searchbar.js',            'views/resource_persistentVolume/resource_persistentVolume.css'        ]    }])    .controller('configMapCtrl', ['$log', 'Ws', 'DeploymentConfig', 'persistent', '$state', '$rootScope', '$scope', 'configmaps', 'secretskey','Sort',        function ($log, Ws, DeploymentConfig, persistent, $state, $rootScope, $scope, configmaps, secretskey,Sort) {            $scope.grid = {                page: 1,                size: 10,                txt: ''            };            $scope.$watch('grid.page', function (newVal, oldVal) {                if (newVal != oldVal) {                    refresh(newVal);                }            });            var refresh = function (page) {                $(document.body).animate({                    scrollTop: 0                }, 200);                var skip = (page - 1) * $scope.grid.size;                $scope.configitems = $scope.configdata.slice(skip, skip + $scope.grid.size) || [];            };            $scope.$on('$destroy', function () {                Ws.clear();            });            $scope.loadconfigmaps = function () {                configmaps.get({namespace: $rootScope.namespace, region: $rootScope.region}, function (res) {                    if (res.items && res.items.length > 0) {                        angular.forEach(res.items, function (item, i) {                            res.items[i].sorttime = (new Date(item.metadata.creationTimestamp)).getTime()                        });                        // console.log($scope.items);                        res.items.sort(function (x, y) {                            return x.sorttime > y.sorttime ? -1 : 1;                        });                        if (!res.items) {                            $scope.configdata = [];                        } else {                            $scope.configdata = res.items;                            console.log( $scope.configdata)                            console.log( res.items)                            $scope.data = res.items;                        }                        $scope.copyconfigdata = angular.copy($scope.configdata);                        $scope.grid.total = $scope.configdata.length;                        $scope.grid.page = 1;                        $scope.grid.txt = '';                        refresh(1);                        $scope.uex_back = true;                        $scope.uex_front = false;                        // 排列 如果页数发生变化而且点击排序按钮，就refresh()                        $scope.sortDetail = function () {                            if ($scope.uex_back) {                                // alert(1);                                $scope.configdata = Sort.sort($scope.configdata, 1); //排序                                $scope.uex_back = false;                                $scope.uex_front = true;                                $scope.copyconfigdata = angular.copy($scope.configdata);                                refresh($scope.grid.page);                            } else {                                // alert(13);                                //默认降序                                $scope.configdata = Sort.sort($scope.configdata, -1); //排序                                $scope.uex_back = true;                                $scope.uex_front = false;                                $scope.copyconfigdata = angular.copy($scope.configdata);                                refresh($scope.grid.page);                            }                                if ($scope.text_seach &&$scope.uex_front) {                                    // alert(1);                                    $scope.configdata_search= Sort.sort($scope.configdata_search, 1); //排序                                    $scope.uex_back = false;                                    $scope.uex_front = true;                                    $scope.configdata= angular.copy($scope.configdata_search);                                    refresh(1);                                }                                if ($scope.text_seach && $scope.uex_back) {                                    // alert(13);                                    //默认降序                                    $scope.configdata_search = Sort.sort($scope.configdata_search, -1); //排序                                    $scope.uex_back = true;                                    $scope.uex_front = false;                                    $scope.configdata= angular.copy($scope.configdata_search);                                    refresh(1);                            }                        }                    }                })            };            $scope.newreload = function () {                $scope.loadconfigmaps();            };            $scope.text = '您还没有创建配置卷';            $scope.begin_blank=true;            $scope.search = function (event) {                if (!$scope.grid.txt) {                    $scope.text_seach = '';                    $scope.configdata = angular.copy($scope.data);                    $scope.uex_back = true;                    $scope.uex_front = false;                    $scope.grid.page=1;                    refresh(1);                    $scope.grid.total = $scope.configdata.length;                    return;                }                $scope.configdata = [];                var iarr = [];                var str = $scope.grid.txt;                str = str.toLocaleLowerCase();                $scope.text_seach = str;                //console.log('$scope.copydata', $scope.copydata);                angular.forEach($scope.copyconfigdata, function (item, i) {                    //console.log(item.build);                    var nstr = item.metadata.name;                    nstr = nstr.toLocaleLowerCase();                    if (nstr.indexOf(str) !== -1) {                        iarr.push(item)                    }                    //console.log(repo.instance_data, $scope.grid.txt);                });                $scope.isQuery=false;                if (iarr.length === 0) {                    $scope.isQuery = true;                    $scope.begin_blank=false;                    $scope.text = '没有查询到符合条件的数据';                }                else {                    $scope.text = '您还没有任何配置卷数据，现在就创建一个吧';                }                $scope.configdata = angular.copy(iarr);                $scope.configdata_search =  $scope.configdata;                // console.log($scope.configdata)                refresh(1);                //console.log('$scope.data', $scope.configdata);                $scope.grid.total = $scope.configdata.length;            };            $scope.loadconfigmaps();        }]);